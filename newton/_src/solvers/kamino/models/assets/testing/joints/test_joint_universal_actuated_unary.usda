#usda 1.0
(
    doc = """Authored manually for testing purposes."""
    defaultPrim = "test_joint_universal_actuated_unary"
    timeCodesPerSecond = 1000
    kilogramsPerUnit = 1
    metersPerUnit = 1
    upAxis = "Z"
)

def PhysicsScene "World"
{
    float physics:gravityMagnitude = 9.8067
    vector3f physics:gravityDirection = (0, 0, -1)
}

def Xform "test_joint_universal_actuated_unary"
{
    def Scope "RigidBodies"
    {
        def Xform "body_1" (
            prepend apiSchemas = ["PhysicsRigidBodyAPI", "PhysicsMassAPI"]
        )
        {
            # Body Frame
            quatf xformOp:orient = (1, 0, 0, 0)
            double3 xformOp:translate = (0.0193489, 0.0554506, -0.00224473)
            uniform token[] xformOpOrder = ["xformOp:translate", "xformOp:orient"]

            # Body Velocities
            vector3f physics:linearVelocity = (0, 0, 0)
            vector3f physics:angularVelocity = (0, 0, 0)

            # Mass Properties
            float physics:mass = 0.202599
            float3 physics:diagonalInertia = (1.31518e-05, 8.59479e-05, 8.6375e-05)
            point3f physics:centerOfMass = (0, 0, 0)
            quatf physics:principalAxes = (-0.0356189, -0.427367, 0.849557, -0.307151)
        }
    }

    def Scope "Joints"
    {
        # NOTE: The `PhysicsD6Joint` type does not work, D6 joints are specified using `PhysicsJoint`
        def PhysicsJoint "actuated_universal_joint" (
            customData = {string dofs = "universal"}
            prepend apiSchemas = [
                # NOTE: These enable the UsdPhysics.JointLimit(...) attributes
                "PhysicsLimitAPI:transX",
                "PhysicsLimitAPI:transY",
                "PhysicsLimitAPI:transZ",
                "PhysicsLimitAPI:rotX",
                "PhysicsLimitAPI:rotY",
                "PhysicsLimitAPI:rotZ",
                # # NOTE: These enable the UsdPhysics.JointDrive(...) attributes
                "PhysicsDriveAPI:rotX",
                "PhysicsDriveAPI:rotY",
            ]
        )
        {
            bool physics:jointEnabled = 1

            rel physics:body1 = </test_joint_universal_actuated_unary/RigidBodies/body_1>

            point3f physics:localPos0 = (-0.0103314, 0.0223859, 0.0129223)
            point3f physics:localPos1 = (-0.0296803, -0.0330647, 0.0151671)
            quatf physics:localRot0 = (-0.220973, 0.448949, 0.477656, 0.722122)
            quatf physics:localRot1 = (-0.220973, 0.448949, 0.477656, 0.722122)

            bool physics:collisionEnabled = 0

            # low > high makes transX a constraint axis
            float limit:transX:physics:low = 1
            float limit:transX:physics:high = -1

            # low > high makes transY a constraint axis
            float limit:transY:physics:low = 1
            float limit:transY:physics:high = -1

            # low > high makes transZ a constraint axis
            float limit:transZ:physics:low = 1
            float limit:transZ:physics:high = -1

            # rotX is the first DoF of the universal joint
            float limit:rotX:physics:low = -90
            float limit:rotX:physics:high = 90

            # rotY is the second DoF of the universal joint
            float limit:rotY:physics:low = -90
            float limit:rotY:physics:high = 90

            # low > high makes rotZ a constraint axis
            float limit:rotZ:physics:low = 1
            float limit:rotZ:physics:high = -1

            # Drive of the first DoF
            float drive:rotX:physics:maxForce = 100.0
            uniform token drive:rotX:physics:type = "force"  # can be in {"force", "acceleration"}

            # Drive of the second DoF
            float drive:rotY:physics:maxForce = 200.0
            uniform token drive:rotY:physics:type = "force"  # can be in {"force", "acceleration"}
        }
    }
}
